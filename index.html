<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>MDE Games</title>
<meta name="theme-color" content="#f2f2f7">

<style>
:root{
  --apple-blue:#0A84FF;
  --apple-red:#FF453A;
  --label-primary:#1c1c1e;
  --label-secondary:#3a3a3c;
  --glass-warm:rgba(255,255,255,.9);
  --glass-neutral:rgba(255,255,255,.75);
  --glass-cool:rgba(255,255,255,.6);
  --blur:26px;
  --motion:cubic-bezier(.22,.61,.36,1);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display","Segoe UI",Roboto;
  background:#f2f2f7;
  color:var(--label-primary);
}

/* ===== HAVOr ===== */
.havor{transition:transform .25s var(--motion),opacity .25s}
.havor:hover{transform:translateY(-1px)}
.havor:active{transform:scale(.96)}

/* ===== HEADER ===== */
.header{
  position:sticky;top:0;z-index:50;
  padding:12px 14px;
  backdrop-filter:blur(12px);
}
.apple-nav{
  display:flex;gap:10px;
  padding:8px 12px;border-radius:24px;
  background:rgba(255,255,255,.75);
}
.apple-tab{
  flex:1;text-align:center;
  padding:6px 0;border-radius:18px;
  font-size:15px;font-weight:600;
  color:var(--label-secondary);
  cursor:pointer;
}
.apple-tab.active,
.apple-tab.station-active{
  background:#fff;
  color:var(--apple-blue);
}
.apple-tab.new{color:var(--apple-red)}
.station-badge{
  margin-left:6px;
  padding:2px 7px;
  border-radius:999px;
  font-size:11px;
  font-weight:600;
  background:rgba(10,132,255,.15);
  color:var(--apple-blue);
}

/* ===== GRID ===== */
.container{padding:14px}
.grid{display:grid;gap:14px;grid-template-columns:repeat(3,1fr)}
@media(min-width:768px){.grid{grid-template-columns:repeat(4,1fr)}}
@media(min-width:1024px){.grid{grid-template-columns:repeat(5,1fr)}}

/* ===== CARD ===== */
.card{
  position:relative;
  border-radius:22px;
  overflow:hidden;
  background:rgba(255,255,255,.92);
  backdrop-filter:blur(var(--blur));
  box-shadow:0 10px 26px rgba(0,0,0,.12);
}
.card.multiplayer{
  box-shadow:
    0 1px 0 rgba(255,255,255,.9) inset,
    0 14px 34px rgba(10,132,255,.25);
}
.card img{width:100%;aspect-ratio:1/1;object-fit:cover}
.label{padding:14px;font-size:13px}
.new-badge{
  position:absolute;top:10px;left:10px;
  padding:4px 10px;border-radius:999px;
  background:var(--apple-red);color:#fff;
  font-size:11px;font-weight:600;
}

/* ===== PLAYER BADGE ===== */
.player-badge{
  display:inline-flex;
  align-items:center;
  padding:4px 10px;
  border-radius:999px;
  font-size:11px;
  font-weight:600;
  background:rgba(10,132,255,.12);
  color:var(--apple-blue);
}
.player-badge.single{
  background:rgba(60,60,67,.12);
  color:#3a3a3c;
}

/* ===== STATION POPUP ===== */
.station-popup{
  position:fixed;inset:0;
  display:none;
  align-items:flex-end;
  background:rgba(0,0,0,.28);
  backdrop-filter:blur(18px) saturate(120%);
  z-index:200;
}
.station-popup.active{display:flex}

.station-box{
  width:100%;
  max-height:70vh;
  padding:10px 16px 30px;
  border-radius:32px 32px 0 0;
  background:linear-gradient(
    180deg,
    var(--glass-warm),
    var(--glass-neutral),
    var(--glass-cool)
  );
  backdrop-filter:blur(var(--blur)) saturate(160%);
  transform:translateY(100%);
  transition:transform .55s var(--motion);
  will-change:transform;
}
.station-popup.active .station-box{transform:translateY(0)}

.drag-handle{
  width:36px;height:5px;
  margin:6px auto 14px;
  border-radius:999px;
  background:#c7c7cc;
}

.station-list{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:14px;
}
.station-item{
  padding:14px 16px;
  border-radius:18px;
  background:rgba(255,255,255,.55);
  display:flex;
  justify-content:space-between;
  font-weight:600;
}
.station-count{
  min-width:28px;height:22px;
  padding:0 8px;
  border-radius:999px;
  background:#fff;
  font-size:12px;
}
@keyframes softPulse{
  0%{box-shadow:0 0 0 0 rgba(255,69,58,.35)}
  70%{box-shadow:0 0 0 6px rgba(255,69,58,0)}
}
.station-count.pulse{animation:softPulse 1.8s infinite}

/* ===== ADMIN ===== */
.admin-float{
  position:sticky;
  top:72px;
  z-index:20;
  display:flex;
  justify-content:space-between;
  padding:10px 12px;
  margin-bottom:14px;
  border-radius:22px;
  background:rgba(255,255,255,.75);
  backdrop-filter:blur(16px);
}
.icon-btn{
  background:none;
  border:none;
  padding:8px;
  cursor:pointer;
  color:#1c1c1e;
  display:flex;
  align-items:center;
  justify-content:center;
}
.icon-btn svg{width:22px;height:22px}
.icon-btn:hover{opacity:.65}

.admin-card{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px 14px;
  margin-bottom:12px;
  border-radius:18px;
  background:rgba(255,255,255,.88);
}
.admin-card img{
  width:52px;height:52px;
  border-radius:12px;
}

/* ===== POPUP ===== */
.popup,.lock{
  position:fixed;inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.25);
  backdrop-filter:blur(12px);
  z-index:300;
}
.popup-body,.lock-box{
  width:320px;
  background:rgba(255,255,255,.92);
  border-radius:24px;
  padding:20px;
}
.popup-body input,.popup-body select,.lock-box input{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  border:none;
  border-radius:14px;
}
.station-multi{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(48px,1fr));
  gap:8px;
}
.station-multi div{
  padding:8px;
  border-radius:999px;
  background:#fff;
  text-align:center;
  font-weight:600;
}
.station-multi .active{
  background:rgba(10,132,255,.25);
}

/* ===== MODAL ACTION ===== */
.modal-actions{
  position:sticky;
  bottom:0;
  margin-top:16px;
  padding-top:14px;
  display:flex;
  justify-content:flex-end;
  gap:12px;
  background:linear-gradient(to top,rgba(255,255,255,.95),rgba(255,255,255,0));
}
.btn-save{
  display:flex;
  align-items:center;
  gap:8px;
  padding:12px 20px;
  border-radius:999px;
  border:none;
  background:var(--apple-blue);
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
.btn-save svg{width:18px;height:18px}
.btn-cancel{
  padding:12px 18px;
  border-radius:999px;
  border:none;
  background:rgba(0,0,0,.08);
  font-weight:600;
}

/* ===== TOAST ===== */
.toast{
  position:fixed;
  left:50%;
  bottom:28px;
  transform:translateX(-50%) translateY(20px);
  background:rgba(0,0,0,.85);
  color:#fff;
  padding:10px 16px;
  border-radius:999px;
  font-size:13px;
  font-weight:600;
  opacity:0;
  transition:.35s var(--motion);
  z-index:500;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
</style>
</head>

<body>

<!-- SVG ICONS -->
<svg style="display:none">
  <symbol id="i-add" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></symbol>
  <symbol id="i-edit" viewBox="0 0 24 24"><path d="M4 20l4-1 10-10-3-3L5 16l-1 4z" fill="currentColor"/></symbol>
  <symbol id="i-trash" viewBox="0 0 24 24"><path d="M6 7h12M9 7v10M15 7v10M8 7l1-2h6l1 2M6 7v12h12V7" stroke="currentColor" stroke-width="2"/></symbol>
  <symbol id="i-backup" viewBox="0 0 24 24"><path d="M12 3v12M8 9l4-4 4 4M5 21h14" stroke="currentColor" stroke-width="2"/></symbol>
  <symbol id="i-restore" viewBox="0 0 24 24"><path d="M12 21V9M16 13l-4 4-4-4M5 3h14" stroke="currentColor" stroke-width="2"/></symbol>
  <symbol id="i-logout" viewBox="0 0 24 24"><path d="M9 6l-4 4 4 4M5 10h10M13 3h6v14h-6" stroke="currentColor" stroke-width="2"/></symbol>
</svg>

<div class="header">
  <div class="apple-nav">
    <div class="apple-tab active" onclick="showGames(this)">Games</div>
    <div class="apple-tab" onclick="openStationPopup()">
      Station <span id="stationBadge" class="station-badge"></span>
    </div>
    <div class="apple-tab new" onclick="showNew(this)">New</div>
    <div class="apple-tab" onclick="showAdmin(this)">Admin</div>
  </div>
</div>

<div class="container" id="gamesTab"></div>
<div class="container" id="adminTab" style="display:none"></div>

<!-- STATION POPUP -->
<div class="station-popup" id="stationPopup" onclick="closeStationPopup()">
  <div class="station-box">
    <div class="drag-handle"></div>
    <div class="station-list" id="stationList"></div>
  </div>
</div>

<!-- ADD / EDIT -->
<div class="popup" id="gamePopup">
  <div class="popup-body">
    <strong id="popupTitle">Add Game</strong><br><br>
    <input id="gName" placeholder="Nama Game">
    <input id="gImg" placeholder="Image URL">
    <select id="gCat"><option>PS5</option><option>PS4</option></select>
    <select id="gPlayer"><option value="1">1 Player</option><option value="2">2 Player</option></select>
    <div class="station-multi" id="stationMulti"></div>
    <label><input type="checkbox" id="gNew"> NEW</label>

    <div class="modal-actions">
      <button class="btn-cancel" onclick="closePopup()">Cancel</button>
      <button class="btn-save" onclick="saveGame()">
        <svg id="saveIcon"><use href="#i-add"/></svg>
        <span id="saveText">Save</span>
      </button>
    </div>
  </div>
</div>

<!-- LOGIN -->
<div class="lock" id="lock">
  <div class="lock-box">
    <strong>Admin Login</strong><br><br>
    <input id="u" placeholder="User">
    <input id="p" type="password" placeholder="Password">
    <div style="display:flex;gap:12px;justify-content:flex-end">
      <button class="btn-cancel" onclick="goHome()">Home</button>
      <button class="btn-save" onclick="login()">Login</button>
    </div>
  </div>
</div>

<div id="toast" class="toast">Saved</div>

<script>
const DB='mde_games';
const SEEN_KEY='mde_seen_stations';

/* ===== HAPTIC ===== */
function haptic(ms=8){
  if(navigator.vibrate) navigator.vibrate(ms);
}

/* ===== LOAD & CLEAN DATA (ANTI UNDEFINED) ===== */
let games = JSON.parse(localStorage.getItem(DB)) || [];
games = games
  .filter(g => g && typeof g.name === 'string' && g.name.trim() !== '')
  .map(g => ({
    name: (g.name || '').trim(),
    img: (g.img || 'https://picsum.photos/300').trim(),
    cat: typeof g.cat === 'string' && ['PS5','PS4'].includes(g.cat) ? g.cat : 'PS5',
    player: g.player === 2 ? 2 : 1,
    stations: Array.isArray(g.stations) ? g.stations.map(s => parseInt(s)).filter(s => !isNaN(s) && s >= 1 && s <= 10) : [],
    isNew: Boolean(g.isNew)
  }));
localStorage.setItem(DB, JSON.stringify(games));

let seenStations = JSON.parse(localStorage.getItem(SEEN_KEY)) || [];
let editIndex=null;

/* ===== NAV ===== */
function setActive(el){
  document.querySelectorAll('.apple-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
}
function closeAllTabsHighlight(){
  document.querySelectorAll('.apple-tab').forEach(t=>t.classList.remove('station-active'));
}

/* ===== RENDER GAMES ===== */
function renderGames(list=games){
  gamesTab.innerHTML='<div class="grid">'+list.map(g=>`
    <div class="card havor ${g.player>1?'multiplayer':''}">
      ${g.isNew?'<div class="new-badge">NEW</div>':''}
      <img src="${g.img}">
      <div class="label">
        <strong>${g.name}</strong><br>
        <div style="margin-top:6px;display:flex;gap:6px;flex-wrap:wrap">
          <span class="player-badge ${g.player>1?'':'single'}">${'ð®'.repeat(g.player||1)}</span>
          <span class="player-badge single">${g.cat||'PS5'}</span>
        </div>
      </div>
    </div>
  `).join('')+'</div>';
}

/* ===== TABS ===== */
function showGames(el){
  closeStationPopup();
  setActive(el);
  adminTab.style.display='none';
  gamesTab.style.display='block';
  renderGames();
}
function showNew(el){
  closeStationPopup();
  setActive(el);
  adminTab.style.display='none';
  gamesTab.style.display='block';
  renderGames(games.filter(g=>g.isNew));
}

/* ===== STATION ===== */
function updateStationBadge(){
  let count=0;
  for(let i=1;i<=10;i++){
    if(games.some(g=>g.stations.includes(i))) count++;
  }
  stationBadge.textContent=count||'';
}
function openStationPopup(){
  closeAllTabsHighlight();
  document.querySelectorAll('.apple-tab').forEach(t=>{
    if(t.textContent.includes('Station')) t.classList.add('station-active');
  });
  stationList.innerHTML='';
  for(let i=1;i<=10;i++){
    const list=games.filter(g=>g.stations.includes(i));
    const pulse=list.some(g=>g.isNew)&&!seenStations.includes(i);
    stationList.innerHTML+=`
      <div class="station-item havor" onclick="filterStation(${i})">
        Station ${i}
        <span class="station-count ${pulse?'pulse':''}">${list.length}</span>
      </div>`;
  }
  stationPopup.classList.add('active');
}
function closeStationPopup(){
  if(!stationPopup.classList.contains('active')) return;
  const box=document.querySelector('.station-box');
  box.style.transform='translateY(100%)';
  setTimeout(()=>{
    stationPopup.classList.remove('active');
    box.style.transform='translateY(0)';
  },300);
  closeAllTabsHighlight();
}
function filterStation(n){
  haptic(10);
  if(!seenStations.includes(n)){
    seenStations.push(n);
    localStorage.setItem(SEEN_KEY,JSON.stringify(seenStations));
  }
  closeStationPopup();
  renderGames(games.filter(g=>g.stations.includes(n)));
}

/* ===== ADMIN ===== */
function showAdmin(el){
  closeStationPopup();
  setActive(el);
  gamesTab.style.display='none';
  adminTab.style.display='block';
  if(!sessionStorage.getItem('admin')){
    lock.style.display='flex';
    return;
  }
  renderAdmin();
}
function renderAdmin(){
  adminTab.innerHTML=`
    <div class="admin-float">
      <div style="display:flex;gap:14px">
        <button class="icon-btn" onclick="openAdd()"><svg><use href="#i-add"/></svg></button>
        <button class="icon-btn" onclick="backup()"><svg><use href="#i-backup"/></svg></button>
        <button class="icon-btn" onclick="restore()"><svg><use href="#i-restore"/></svg></button>
      </div>
      <button class="icon-btn" onclick="logout()"><svg><use href="#i-logout"/></svg></button>
    </div>
    ${games.map((g,i)=>`
      <div class="admin-card havor">
        <img src="${g.img}">
        <div style="flex:1"><strong>${g.name}</strong><br>${g.cat||'PS5'}</div>
        <button class="icon-btn" onclick="editGame(${i})"><svg><use href="#i-edit"/></svg></button>
        <button class="icon-btn" onclick="deleteGame(${i})"><svg><use href="#i-trash"/></svg></button>
      </div>
    `).join('')}
  `;
}

/* ===== ADD / EDIT ===== */
function openAdd(){
  editIndex=null;
  popupTitle.textContent='Add Game';
  saveText.textContent='Save';
  saveIcon.querySelector('use').setAttribute('href','#i-add');
  gName.value='';gImg.value='';gCat.value='PS5';gPlayer.value='1';gNew.checked=false;
  stationMulti.innerHTML='';
  for(let i=1;i<=10;i++){
    const d=document.createElement('div');
    d.textContent='S'+i;
    d.onclick=()=>d.classList.toggle('active');
    stationMulti.appendChild(d);
  }
  gamePopup.style.display='flex';
}
function editGame(i){
  const g=games[i];
  editIndex=i;
  openAdd();
  popupTitle.textContent='Edit Game';
  saveText.textContent='Update';
  saveIcon.querySelector('use').setAttribute('href','#i-edit');
  gName.value=g.name;
  gImg.value=g.img;
  gCat.value=g.cat||'PS5';
  gPlayer.value=g.player||1;
  gNew.checked=g.isNew;
  [...stationMulti.children].forEach((d,j)=>{
    if(g.stations.includes(j+1)) d.classList.add('active');
  });
}
function saveGame(){
  const name = (gName.value || '').trim();
  if(!name){
    showToast('Nama game diperlukan');
    return;
  }
  const img = (gImg.value || '').trim() || 'https://picsum.photos/300';
  const cat = ['PS5','PS4'].includes(gCat.value) ? gCat.value : 'PS5';
  const player = (gPlayer.value === '2') ? 2 : 1;
  const isNew = gNew.checked;

  const stations = [...stationMulti.children]
    .map((d,i) => d.classList.contains('active') ? i+1 : null)
    .filter(n => n !== null);

  const g = { name, img, cat, player, stations, isNew };

  if(editIndex !== null){
    games[editIndex] = g;
  } else {
    games.push(g);
  }
  localStorage.setItem(DB, JSON.stringify(games));
  closePopup();
  renderGames();
  if(adminTab.style.display === 'block') renderAdmin();
  updateStationBadge();
  showToast(editIndex !== null ? 'Updated successfully' : 'Saved successfully');
}
function deleteGame(i){
  if(confirm('Padam game ini?')){
    games.splice(i,1);
    localStorage.setItem(DB,JSON.stringify(games));
    renderGames();
    renderAdmin();
    updateStationBadge();
  }
}
function closePopup(){gamePopup.style.display='none'}

/* ===== AUTH ===== */
function login(){
  if(u.value==='ak'&&p.value==='ak7777'){
    sessionStorage.setItem('admin',1);
    lock.style.display='none';
    renderAdmin();
  } else {
    showToast('Login failed');
  }
}
function logout(){
  sessionStorage.removeItem('admin');
  showGames(document.querySelector('.apple-tab'));
}
function goHome(){
  lock.style.display='none';
  showGames(document.querySelector('.apple-tab'));
}

/* ===== BACKUP / RESTORE ===== */
function backup(){
  const dataStr = JSON.stringify(games, null, 2);
  const blob = new Blob([dataStr], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
  a.download = `mde_games_backup_${timestamp}.json`;
  a.click();
  URL.revokeObjectURL(url);
}
function restore(){
  const i=document.createElement('input');
  i.type='file';
  i.accept='.json';
  i.onchange=e=>{
    const file = e.target.files[0];
    if(!file) return;
    const r=new FileReader();
    r.onload=()=>{
      try{
        const parsed = JSON.parse(r.result);
        if(Array.isArray(parsed)){
          games = parsed
            .filter(g => g && typeof g.name === 'string' && g.name.trim() !== '')
            .map(g => ({
              name: (g.name || '').trim(),
              img: (g.img || 'https://picsum.photos/300').trim(),
              cat: ['PS5','PS4'].includes(g.cat) ? g.cat : 'PS5',
              player: g.player === 2 ? 2 : 1,
              stations: Array.isArray(g.stations) ? g.stations.map(s => parseInt(s)).filter(s => !isNaN(s) && s >= 1 && s <= 10) : [],
              isNew: Boolean(g.isNew)
            }));
          localStorage.setItem(DB, JSON.stringify(games));
          renderGames();
          renderAdmin();
          updateStationBadge();
          showToast('Restore successful');
        } else {
          throw new Error('Not an array');
        }
      } catch (err) {
        showToast('Fail: JSON tidak sah');
        console.error(err);
      }
    };
    r.readAsText(file);
  };
  i.click();
}

/* ===== TOAST ===== */
function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),1800);
}

/* ===== INIT ===== */
renderGames();
updateStationBadge();

/* ===== SWIPE DOWN TO CLOSE (iOS-like) ===== */
let startY=0,currentY=0,dragging=false;
const sheet=document.querySelector('.station-box');

sheet.addEventListener('touchstart',e=>{
  startY=e.touches[0].clientY;
  dragging=true;
  sheet.style.transition='none';
});
sheet.addEventListener('touchmove',e=>{
  if(!dragging) return;
  currentY=e.touches[0].clientY;
  const diff=currentY-startY;
  if(diff>0){
    sheet.style.transform=`translateY(${diff}px)`;
  }
});
sheet.addEventListener('touchend',()=>{
  dragging=false;
  sheet.style.transition='transform .55s var(--motion)';
  const diff=currentY-startY;
  if(diff>120){
    closeStationPopup();
  }else{
    sheet.style.transform='translateY(0)';
  }
  startY=0;currentY=0;
});
</script>

</body>
</html>

