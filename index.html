<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<title>ESPORTS CHALLENGE HSWP 2026</title>

<style>
body{font-family:Arial;background:#f5f5f5;margin:0;padding:20px}
h1{text-align:center}

.container{display:grid;grid-template-columns:1.2fr 1fr;gap:20px}
.card{background:#fff;border-radius:20px;padding:20px}

.tabs button{border:none;padding:8px 18px;border-radius:20px;margin-right:6px;cursor:pointer;background:#eee}
.tabs .active{background:#caa24d}

.btn{border:none;padding:8px 18px;border-radius:20px;color:#fff;cursor:pointer}
.btn-lock{background:#2ecc71}
.btn-unlock{background:#999}
.btn-reset{background:#e74c3c}

table{width:100%;border-collapse:collapse;margin-top:14px}
th,td{border-bottom:1px solid #eee;padding:8px;text-align:center}
td.team{text-align:left}

.badge{background:#000;color:#fff;padding:2px 8px;border-radius:12px;font-size:11px}
.box{background:#eee;border-radius:10px;padding:6px 10px;min-width:36px;display:inline-block}
.clickable{cursor:pointer}

.drag-handle{cursor:grab;font-size:18px;color:#888;padding-right:6px}

.toast{
 position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
 background:#333;color:#fff;padding:10px 18px;border-radius:16px;display:none
}

/* popup */
.popup{
 position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;
 align-items:center;justify-content:center;z-index:1000
}
.popup-box{background:#fff;border-radius:18px;padding:20px}
.kill-grid{display:grid;grid-template-columns:repeat(5,60px);gap:8px}
.kill-grid div{border:1px solid #000;padding:10px;text-align:center;cursor:pointer}
.kill-grid .active{background:#caa24d}
.popup-actions{text-align:right;margin-top:12px}
.btn-save{background:#2ecc71}
.btn-cancel{background:#aaa}
</style>
</head>

<body>

<h1>ESPORTS CHALLENGE HSWP 2026</h1>

<div class="container">

<!-- MAP STANDING -->
<div class="card">
<h3>MAP STANDING</h3>

<div class="tabs">
  <button id="tab-erangel">Erangel</button>
  <button id="tab-miramar">Miramar</button>
  <button id="tab-rondo">Rondo</button>
</div>

<div style="margin-top:10px">
  <button id="lockBtn" class="btn btn-lock">LOCK</button>
  <button id="resetBtn" class="btn btn-reset">RESET MAP</button>
</div>

<table>
<thead>
<tr>
  <th>No</th><th style="text-align:left">Team</th>
  <th>WWCD</th><th>Placement</th><th>Kill</th><th>Total</th>
</tr>
</thead>
<tbody id="mapTable"></tbody>
</table>
</div>

<!-- ALL STANDING -->
<div class="card">
<h3>ALL STANDING</h3>
<table>
<thead>
<tr>
  <th>No</th><th style="text-align:left">Team</th>
  <th>WWCD</th><th>Placement</th><th>Kill</th><th>Total</th>
</tr>
</thead>
<tbody id="allTable"></tbody>
</table>
</div>

</div>

<div class="toast" id="toast"></div>

<!-- KILL POPUP -->
<div class="popup" id="killPopup">
  <div class="popup-box">
    <h4>Pilih Kill</h4>
    <div class="kill-grid" id="killGrid"></div>
    <div class="popup-actions">
      <button class="btn btn-cancel">CANCEL</button>
      <button class="btn btn-save">SAVE</button>
    </div>
  </div>
</div>

<script>
/* ================= DATA ================= */
const STORAGE_KEY = "HSWP_2026";

const TEAMS=[
"OL","Zentra","JURNEE 52","HEe ESPORT","AING BALANG","MANTARAY GIANT",
"SolJar","Yelnats","Martabak Esport","THE RED X","SANTAi KiLLERs",
"TOP PANDA","ROBOX","DND","FAM | United","REDBULL 26 ESPORTS"
];

const placementPoint=p=>p===1?10:p===2?6:p===3?5:p===4?4:p===5?3:p===6?2:(p===7||p===8)?1:0;

/* ================= STATE ================= */
function freshState(){
 return {
  currentMap:"erangel",
  maps:{
   erangel:{locked:false,order:[...TEAMS],data:{}},
   miramar:{locked:false,order:[...TEAMS],data:{}},
   rondo:{locked:false,order:[...TEAMS],data:{}}
  }
 };
}

let state = JSON.parse(localStorage.getItem(STORAGE_KEY)) || freshState();

// ensure structure
TEAMS.forEach(t=>{
 for(const m in state.maps){
  if(!state.maps[m].data[t]) state.maps[m].data[t]={kill:0};
 }
});

function saveState(){
 localStorage.setItem(STORAGE_KEY,JSON.stringify(state));
}

/* ================= UTIL ================= */
const $=id=>document.getElementById(id);
function toast(msg){
 $("toast").innerText=msg;
 $("toast").style.display="block";
 setTimeout(()=>$("toast").style.display="none",2000);
}

/* ================= MAP SWITCH ================= */
["erangel","miramar","rondo"].forEach(m=>{
 $("tab-"+m).onclick=()=>switchMap(m);
});

function switchMap(m){
 state.currentMap=m;
 document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
 $("tab-"+m).classList.add("active");
 saveState();
 render();
}

/* ================= LOCK / RESET ================= */
$("lockBtn").onclick=()=>{
 const map=state.maps[state.currentMap];
 map.locked=!map.locked;
 $("lockBtn").innerText=map.locked?"UNLOCK":"LOCK";
 $("lockBtn").className="btn "+(map.locked?"btn-unlock":"btn-lock");
 toast(map.locked?"ðŸ”’ Map dikunci":"ðŸ”“ Map dibuka");
 saveState();
 render();
};

$("resetBtn").onclick=()=>{
 if(!confirm("Reset map ini?"))return;
 const map=state.maps[state.currentMap];
 map.locked=false;
 map.order=[...TEAMS];
 TEAMS.forEach(t=>map.data[t].kill=0);
 $("lockBtn").innerText="LOCK";
 $("lockBtn").className="btn btn-lock";
 saveState();
 render();
};

/* ================= DRAG ================= */
let dragIndex=null;
function dragStart(i){
 if(state.maps[state.currentMap].locked) return;
 dragIndex=i;
}
function dropRow(i){
 const o=state.maps[state.currentMap].order;
 o.splice(i,0,o.splice(dragIndex,1)[0]);
 saveState();
 render();
}

/* ================= KILL POPUP ================= */
let selectedTeam=null,tempKill=0;

function openKill(team){
 if(state.maps[state.currentMap].locked) return;
 selectedTeam=team;
 tempKill=state.maps[state.currentMap].data[team].kill;
 const g=$("killGrid"); g.innerHTML="";
 for(let i=0;i<=34;i++){
  const d=document.createElement("div");
  d.innerText=i;
  if(i===tempKill)d.classList.add("active");
  d.onclick=()=>{
   tempKill=i;
   document.querySelectorAll(".kill-grid div").forEach(x=>x.classList.remove("active"));
   d.classList.add("active");
  };
  g.appendChild(d);
 }
 $("killPopup").style.display="flex";
}

document.querySelector(".btn-save").onclick=()=>{
 state.maps[state.currentMap].data[selectedTeam].kill=tempKill;
 saveState();
 $("killPopup").style.display="none";
 render();
};
document.querySelector(".btn-cancel").onclick=()=>$("killPopup").style.display="none";

/* ================= RENDER ================= */
function render(){
 const map=state.maps[state.currentMap];
 const tb=$("mapTable"); tb.innerHTML="";
 map.order.forEach((t,i)=>{
  const p=placementPoint(i+1);
  const k=map.data[t].kill;
  tb.innerHTML+=`
  <tr>
   <td draggable="true"
     ondragstart="dragStart(${i})"
     ondragover="event.preventDefault()"
     ondrop="dropRow(${i})">
    <span class="drag-handle">â‰¡</span>${i+1}
   </td>
   <td class="team">${t}</td>
   <td>${i===0?'<span class="badge">WWCD</span>':''}</td>
   <td><span class="box">${p}</span></td>
   <td><span class="box clickable" onclick="openKill('${t}')">${k}</span></td>
   <td>${p+k}</td>
  </tr>`;
 });
 renderAll();
}

function renderAll(){
 const agg={}; TEAMS.forEach(t=>agg[t]={wwcd:0,placement:0,kill:0,total:0});
 for(const m in state.maps){
  const map=state.maps[m]; if(!map.locked)continue;
  map.order.forEach((t,i)=>{
   const p=placementPoint(i+1),k=map.data[t].kill;
   agg[t].placement+=p; agg[t].kill+=k; agg[t].total+=p+k;
   if(i===0)agg[t].wwcd++;
  });
 }
 const sorted=[...TEAMS].sort((a,b)=>{
  const A=agg[a],B=agg[b];
  return B.total-A.total||B.wwcd-A.wwcd||B.placement-A.placement||B.kill-A.kill;
 });
 const tb=$("allTable"); tb.innerHTML="";
 sorted.forEach((t,i)=>{
  const A=agg[t];
  tb.innerHTML+=`
  <tr>
   <td>${i+1}</td><td class="team">${t}</td>
   <td>${A.wwcd}</td><td>${A.placement}</td>
   <td>${A.kill}</td><td>${A.total}</td>
  </tr>`;
 });
}

/* ================= INIT ================= */
switchMap(state.currentMap);
</script>

</body>
</html>